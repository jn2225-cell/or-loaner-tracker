<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OR Loaner Implant Tracker</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF / Canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    .custom-shadow { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    .tab-active { border-bottom: 3px solid #3b82f6; color: #3b82f6; }
  </style>
</head>

<body class="bg-gray-50 min-h-screen font-sans">

<!-- HEADER -->
<header class="bg-blue-700 text-white p-4 shadow-lg sticky top-0 z-50">
  <div class="max-w-4xl mx-auto flex justify-between">
    <h1 class="font-bold">OR Loaner Tracker</h1>
    <div id="user-info" class="text-xs opacity-80">Connectingâ€¦</div>
  </div>
</header>

<!-- MAIN -->
<main class="max-w-4xl mx-auto p-4">

  <div class="bg-white p-6 rounded-xl custom-shadow">
    <form id="loaner-form" class="space-y-4">
      <input id="patientName" placeholder="Patient Name" required class="w-full p-2 border rounded">
      <input id="hospitalNumber" placeholder="Hospital Number" required class="w-full p-2 border rounded">
      <input id="companyName" placeholder="Company Name" required class="w-full p-2 border rounded">
      <input id="implantType" placeholder="Implant / Tray" required class="w-full p-2 border rounded">
      <button class="w-full bg-blue-600 text-white py-2 rounded">Save Entry</button>
    </form>
  </div>

  <div id="list" class="mt-6 space-y-3"></div>

</main>

<!-- FIREBASE + APP LOGIC -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { 
    getAuth, 
    signInAnonymously, 
    onAuthStateChanged 
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { 
    getFirestore, 
    collection, 
    addDoc, 
    onSnapshot, 
    serverTimestamp 
  } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  /* ðŸ”¹ FIREBASE CONFIG */
  const firebaseConfig = {
    apiKey: "AIzaSyBbx2eSpISzDA1puvnynE3pzGT1E6jXkm8",
    authDomain: "or-loaner-tracker.firebaseapp.com",
    projectId: "or-loaner-tracker",
    storageBucket: "or-loaner-tracker.firebasestorage.app",
    messagingSenderId: "152462680465",
    appId: "1:152462680465:web:57ea8cefc1f94ed4f5ba30"
  };

  /* ðŸ”¹ INIT */
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const userInfo = document.getElementById("user-info");

  /* ðŸ”¹ AUTH */
  try {
    await signInAnonymously(auth);
  } catch (e) {
    console.error(e);
    userInfo.innerText = "Auth failed";
  }

  onAuthStateChanged(auth, (user) => {
    if (user) {
      userInfo.innerText = `Logged in: ${user.uid.substring(0,8)}â€¦`;
      loadData();
    }
  });

  /* ðŸ”¹ SAVE FORM */
  document.getElementById("loaner-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    await addDoc(collection(db, "loaners"), {
      patientName: patientName.value,
      hospitalNumber: hospitalNumber.value,
      companyName: companyName.value,
      implantType: implantType.value,
      status: "In OR",
      createdAt: serverTimestamp()
    });
    e.target.reset();
  });

  /* ðŸ”¹ LOAD DATA */
  function loadData() {
    onSnapshot(collection(db, "loaners"), (snap) => {
      const list = document.getElementById("list");
      list.innerHTML = "";
      snap.forEach(doc => {
        const d = doc.data();
        list.innerHTML += `
          <div class="bg-white p-4 rounded custom-shadow">
            <b>${d.implantType}</b><br>
            ${d.patientName} (${d.hospitalNumber})<br>
            <span class="text-xs text-gray-500">${d.companyName}</span>
          </div>
        `;
      });
    });
  }
</script>

</body>
</html>
